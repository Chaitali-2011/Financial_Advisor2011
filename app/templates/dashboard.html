{% extends 'header.html' %}

{% block body %}
<div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="{{url_for('static', filename='img/sidebar-1.jpg')}}">
        <div class="logo"><a class="simple-text logo-normal">Financial Advisor</a></div>
        <div class="sidebar-wrapper">
            <ul class="nav" role="tablist">
                <li class="nav-item active" role="presentation">
                    <a class="nav-link" href="#ahome" aria-controls="ahome" role="tab" data-toggle="tab" data-toggle="tooltip" title="Dashboard">
                        <i class="material-icons">dashboard</i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="#budget" aria-controls="budget" role="tab" data-toggle="tab" data-toggle="tooltip" title="Budget">
                        <i class="material-icons">table_chart</i>
                        <p>Budget</p>
                    </a>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-toggle="tooltip" title="Expense"><i class="material-icons">content_paste</i>
                        <p>Expense<i class="fa fa-caret-down" style="width: 1rem; text-align: center; float: right; vertical-align: 0; border: 0; margin-top: -3px; font-weight: 900; font-family: " Roboto", "Helvetica" , "Arial" , sans-serif;"></i></p>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="width: 230px;" {% if active_tab == 'expense' %} class="active" {% endif %}>
                        <a class="dropdown-item" href="#daily_expense" aria-controls="daily_expense" role="tab" data-toggle="tab">Daily</a>
                        <a class="dropdown-item" href="#monthly_expense" aria-controls="monthly_expense" role="tab" data-toggle="tab">Monthly</a>
                    </div>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="#statistics" aria-controls="statistics" role="tab" data-toggle="tab" data-toggle="tooltip" title="States">
                        <i class="material-icons">pie_chart</i>
                        <p>Stats</p>
                    </a>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="#data" aria-controls="hist" role="tab" data-toggle="tab" data-toggle="tooltip" title="History">
                        <i class="material-icons">history</i>
                        <p>History</p>
                    </a>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="#atable" aria-controls="atable" role="tab" data-toggle="tab" data-toggle="tooltip" title="Predicted budget">
                        <i class="material-icons">insert_chart</i>
                        <p>Prediction of Next Month <br></p>
                        <p style="margin-left:45px;"> Budget </p>
                    </a>
                </li>
                <li class="nav-item " role="presentation">
                    <a class="nav-link" href="#smtable" aria-controls="smtable" role="tab" data-toggle="tab" data-toggle="tooltip" title="Stock Market Prediction">
                        <i class="material-icons">money</i>
                        <p>Stock Market Prediction</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    {% endblock %}
    {% block other %}
    <div class="content">
        <div class="container-fluid">
            <div class="tab-content">
                <div role="tabpanel" {% if active_tab == 'aHome' %} class="tab-pane active" {% else %} class="tab-pane" {% endif %} id="ahome">

                    <h3 style="text-align: center;">Welcome {{ session.username }}!</h3>
                    <br>

                    <form action="" class="form-inline" method="post">

                        <input type="text" class="form-control" name="email" placeholder="{{user_email}}" value="{{request.form.email}}" required>
                        <button type="submit" class="btn btn-primary mb-2" name="submit" value="Save Email">Save</button>
                    </form>

                    <br>

                    <!-- Trigger the modal with a button -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#PasswordModal">Reset Password</button>

                    <!-- Modal -->
                    <div id="PasswordModal" class="modal fade" role="dialog">
                        <div class="modal-dialog modal-md">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Reset Password</h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <h3>Change your password!</h3>
                                    <br>
                                    <form action="" class="form-inline" method="post">
                                        <input type="password" class="form-control" name="NewPassword" value="{{request.form.NewPassword}}" required>
                                        <input class="btn btn-default" type="submit" name="submit" value="Set Password" required>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="budget">
                    <ul>
                        <br>

                        <!-- Trigger the modal with a button -->
                        <button type="button" class="btn btn-primary btn-block" style="width: 50%;" data-toggle="modal" data-target="#myModal">Edit Budget</button>
                        <br>

                        <!-- Modal -->
                        <div id="myModal" class="modal fade" role="dialog">
                            <div class="modal-dialog modal-lg">

                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Calendar</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                                    </div>
                                    <div class="modal-body">
                                        <h3>{{ html_code|safe }}</h3>
                                        <h1>Set Budget for this month!</h1>
                                        <br>
                                        <form action="" class="form-inline" method="post">
                                            <input type="text" class="form-control" placeholder="Budget Amount in Rs." name="amount" value="{{request.form.amount}}" required>
                                            <input class="btn btn-default" type="submit" name="submit" value="Set Budget">
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </ul>
                </div>
                <div role="tabpanel" {% if active_tab == 'expense' and isDaily == True %} class="tab-pane active" {% else %} class="tab-pane" {% endif %} id="daily_expense">
                    <h6>Daily Expense </h6>
                    <ul>
                        {% for cat in CATS["Daily"] %}
                        <br>
                        <div class="container-fluid">
                            <p id="cat_daily">
                                {{cat}}

                                <button class="btn btn-sm btn-info" data-toggle="modal" data-target="#ModalEditDaily{{loop.index}}" style="float:right; background-color: #9c27b0;"><span class="fa fa-edit"></span></button>

                            </p>
                        </div>
                        <!-- Modal -->
                        <div id="ModalEditDaily{{loop.index}}" class="modal fade" role="dialog">
                            <div class="modal-dialog modal-lg">

                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">{{cat}}</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                                    </div>
                                    <div class="modal-body">
                                        <h1>Spent on {{cat}} today!</h1>
                                        <br>
                                        <form action="" class="form-inline" method="post">
                                            <input type="text" class="form-control" placeholder="Amount in Rs." name="amount" value="{{request.form.amount}}" required>
                                            <input type="text" class="form-control" placeholder="Location" name="location" value="{{request.form.location}}">
                                            <input type="text" class="form-control" placeholder="Comments" name="comment" value="{{request.form.comment}}" maxlength="140" size="40">
                                            <br>
                                            <br>
                                            <br>
                                            <input class="btn btn-default" type="submit" name="submit" value="Set {{cat}} amount">
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                </div>

                            </div>
                        </div>

                        {% endfor %}
                    </ul>
                </div>
                <div role="tabpanel" {% if active_tab == 'expense' and isDaily == False %} class="tab-pane active" {% else %} class="tab-pane" {% endif %} id="monthly_expense">
                    <h6>Monthly Expense </h6>
                    <ul>
                        {% for cat in CATS["Monthly"] %}
                        <br>
                        <div class="container-fluid">
                            <p id="cat_daily">
                                {{cat}}

                                <button class="btn btn-sm btn-info" data-toggle="modal" data-target="#ModalEditMonthly{{loop.index}}" style="float:right;background-color: #9c27b0;"><span class="fa fa-edit"></span></button>

                            </p>
                        </div>

                        <!-- Modal -->
                        <div id="ModalEditMonthly{{loop.index}}" class="modal fade" role="dialog">
                            <div class="modal-dialog modal-lg">

                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">{{cat}}</h4>
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                                    </div>
                                    <div class="modal-body">
                                        <h1>Spent for {{cat}}!</h1>
                                        <br>
                                        <form action="" class="form-inline" method="post">
                                            <input type="text" class="form-control" placeholder="Amount in Rs." name="amount" value="{{request.form.amount}}" required>
                                            <input type="text" class="form-control" placeholder="Location" name="location" value="{{request.form.location}}">
                                            <input type="text" class="form-control" placeholder="Comments" name="comment" value="{{request.form.comment}}" maxlength="140" size="40">
                                            <br>
                                            <br>
                                            <br>
                                            <input class="btn btn-default" type="submit" name="submit" value="Set {{cat}} amount">
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                </div>

                            </div>
                        </div>

                        {% endfor %}
                    </ul>
                </div>
                <div role="tabpanel" class="tab-pane" id="statistics">
                    {% for pie in pie_data %}
                    <div class="container-fluid">
                        <br>
                        <embed type="image/svg+xml" src={{pie|safe}}>
                    </div>
                    {% endfor %}
                    <br>
                    <h3>My Expenditure and Budget comparison </h3>
                    <div class="container-fluid">
                        <br>
                        <embed type="image/svg+xml" src={{gauge_data|safe}}>
                    </div>
                    <h4><b>Note:</b> 0 expenditure and 1 budget value implies, you haven't set the budget and expenses for that month!</h4>
                    <br>
                    <br>
                    <br>

                </div>
                <div role="tabpanel" class="tab-pane" id="data" >
                    <div class="container" id="histstyle">
                        <style>
                            #histsyle {
                                margin-top: 10px;
                                padding: 30px 15px;
                                min-height: calc(100vh - 123px);

                        </style>
                        <div class="table-wrapper">
                            <div class="table-title" style="height: 85px;">
                                <div class="row">
                                    <div class="col-sm-5">
                                        <h2>History about Your EXPENSES</h2>
                                    </div>
                                    <div class="col-sm-4">
                                        <form class="navbar-form">
                                            <div class="input-group no-border" style="width: 300px; margin-top: 5px;">
                                                <input type="text" id="myInput" style="color: white;" class="form-control" onkeyup="myFunction()" placeholder="Search...">
                                            </div>
                                        </form>
                                        <script>
                                            $(document).ready(function() {
                                                $("#myInput").on("keyup", function() {
                                                    var value = $(this).val().toLowerCase();
                                                    $("#myTable tr").filter(function() {
                                                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                                                    });
                                                });
                                            });

                                        </script>
                                    </div>
                                    <div class="col-sm-3">
                                        <button class="btn btn-primary" onclick="tableToExcel('testTable', 'W3C Example Table')"><i class="material-icons" style="margin-top:0.1em;margin-left: -4px;">&#xE24D;</i><span style="margin-left: 18px;">Export to Excel</span></button>
                                        <script type="text/javascript">
                                            var tableToExcel = (function() {
                                                var uri = 'data:application/vnd.ms-excel;base64,',
                                                    template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body><table>{table}</table></body></html>',
                                                    base64 = function(s) {
                                                        return window.btoa(unescape(encodeURIComponent(s)))
                                                    },
                                                    format = function(s, c) {
                                                        return s.replace(/{(\w+)}/g, function(m, p) {
                                                            return c[p];
                                                        })
                                                    }
                                                return function(table, name) {
                                                    if (!table.nodeType) table = document.getElementById(table)
                                                    var ctx = {
                                                        worksheet: name || 'Worksheet',
                                                        table: table.innerHTML
                                                    }
                                                    window.location.href = uri + base64(format(template, ctx))
                                                }
                                            })()

                                        </script>
                                    </div>
                                </div>
                            </div>
                            <table id="testTable" class="table table-striped table-hover" style="table-layout: fixed;">
                                <thead>
                                    <tr class="noExl">
                                        <!--<th>Category Name</th>-->
                                        <th style="width:110px;">Category Name</th>
                                        <th style="width:70px;">Spent</th>
                                        <th style="width:150px;">Date of expenditure</th>
                                        <th style="width:130px;">Where Spent</th>
                                        <th style="width:130px;">Description</th>
                                    </tr>
                                </thead>
                                <tbody id="myTable">
                                    {% for expenditure in expenditures %}
                                    <tr>
                                        <td>{{ expenditure.category_name }}</td>
                                        <td>{{ expenditure.spent }}</td>
                                        <td>{{ expenditure.date_of_expenditure }}</td>
                                        <td>{{ expenditure.where_spent}}</td>
                                        <td>{{ expenditure.description}}</td>
                                        <td>
                                            <a href="/expenditure_table/exdelete/{{ expenditure.id }}" class="delete" title="Delete" data-toggle="tooltip"><i class="fa fa-trash"></i></a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    <hr>
                                </tbody>
                            </table>
                            <!--<div class="clearfix">
                                <div class="hint-text">Showing <b>1</b> out of <b>1</b> entries</div>
                                <ul class="pagination">
                                    <li class="page-item disabled"><a href="#">Previous</a></li>
                                    <li class="page-item active"><a href="#" class="page-link">1</a></li>
                                    <li class="page-item"><a href="#" class="page-link">2</a></li>
                                    <li class="page-item"><a href="#" class="page-link">3</a></li>
                                    <li class="page-item"><a href="#" class="page-link">4</a></li>
                                    <li class="page-item"><a href="#" class="page-link">5</a></li>
                                    <li class="page-item"><a href="#" class="page-link">Next</a></li>
                                </ul>
                            </div>-->
                        </div>
                    </div>
                </div>
                <div role="tabpanel" {% if active_tab == 'atable' %} class="tab-pane active" {% else %} class="tab-pane" {% endif %} id="atable">

                    <div class="container" id="tablestyle">
                        <style>
                            #tablesyle {
                                margin-top: 10px;
                                padding: 30px 15px;
                                min-height: calc(100vh - 123px);

                        </style>
                        <div class="table-wrapper">
                            <div class="table-title" style="height: 85px;">
                                <div class="row">
                                    <div class="col-sm-5">
                                        <h2>Prediction for next Month</h2>
                                    </div>
                                    <div class="col-sm-7">
                                        <form action="" class="navbar-form">
                                            <div class="input-group no-border" style="width: 300px; margin-top: 5px;">
                                                <input type="text" id="myInput" style="color: white;" class="form-control" onkeyup="myFunction()" placeholder="Search...">
                                            </div>
                                        </form>
                                        <script>
                                            $(document).ready(function() {
                                                $("#myInput").on("keyup", function() {
                                                    var value = $(this).val().toLowerCase();
                                                    $("#myTable tr").filter(function() {
                                                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                                                    });
                                                });
                                            });

                                        </script>
                                    </div>
                                </div>
                            </div>
                            <form action="" class="form-inline" method="post">
                                <table id="dtBasicExample" class="table table-striped table-hover" style="table-layout: fixed;">
                                    <thead>
                                        <tr>
                                            <th style="width: 150px;">Category Name</th>
                                            <th style="width: 200px;">Previous Month Expense</th>
                                            <th style="width: 200px;">Prediction For next month Expense</th>

                                        </tr>
                                    </thead>
                                    <tbody id="myTable">
                                        <tr>
                                            <td>Food</td>
                                            <td><input type="number" class="form-control" id="food" name="food" placeholder="{{ fo }}" value="{{ fo }}" required><br></td>
                                            <td style="text-align:center">{{ food }}</td>
                                        </tr>
                                        <tr>
                                            <td>Travel</td>
                                            <td><input type="number" class="form-control" id="travel" name="travel" placeholder="{{ tr }}" value="{{ tr }}" required><br></td>
                                            <td style="text-align:center">{{ travel }}</td>
                                        </tr>
                                        <tr>
                                            <td>clothing</td>
                                            <td><input type="number" class="form-control" id="clothing" name="clothing" placeholder="{{ cl }}" value="{{ cl }}" required><br></td>
                                            <td style="text-align:center">{{ clothing }}</td>
                                        </tr>
                                        <tr>
                                            <td>Entertainment</td>
                                            <td><input type="number" class="form-control" id="entertainment" placeholder="{{ en }}" name="entertainment" value="{{ en }}" required><br></td>
                                            <td style="text-align:center" style="text-align:center">{{ entertainment }}</td>
                                        </tr>
                                        <tr>
                                            <td>Online shopping</td>
                                            <td><input type="number" class="form-control" id="onlineshopping" name="onlineshopping" placeholder="{{ on }}" value="{{ on }}" required><br></td>
                                            <td style="text-align:center">{{ onlineshopping }}</td>
                                        </tr>
                                        <tr>
                                            <td>Electricity Bill</td>
                                            <td><input type="number" class="form-control" id="electricity" name="electricity" placeholder="{{ el }}" value="{{ el }}" required><br></td>
                                            <td style="text-align:center">{{ electricity }}</td>
                                        </tr>
                                        <tr>
                                            <td>Water Bill</td>
                                            <td><input type="number" class="form-control" id="waterbill" name="waterbill" placeholder="{{ wa }}" value="{{ wa }}" required><br></td>
                                            <td style="text-align:center">{{ waterbill }}</td>
                                        </tr>
                                        <tr>
                                            <td>Gas</td>
                                            <td><input type="number" class="form-control" id="gas" name="gas" placeholder="{{ ga }}" value="{{ ga }}" required><br></td>
                                            <td style="text-align:center">{{ gas }}</td>
                                        </tr>
                                        <tr>
                                            <td>Groceries</td>
                                            <td><input type="groceries" class="form-control" id="fnum" name="groceries" placeholder="{{ gr }}" value="{{ gr }}" required><br></td>
                                            <td style="text-align:center">{{ groceries }}</td>
                                        </tr>
                                        <hr>
                                        <tr>

                                            <td>Expense Total: {{ total }}</td>
                                            <td>Predicted Expense Total: {{ total_ }}</td>
                                        </tr>
                                        <tr style="text-align: center;">
                                            <td colspan="3">
                                                <marquee>Your budget of next month must be in between 6000 to 25000 for good prediction
                                                </marquee>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td style="background-color: #9c27b0; color: white;">Expected Savings: {{ saving }}</td>
                                        </tr>

                                    </tbody>
                                </table>
                                <button class="btn btn-primary" type="submit" name="submit" value="predict">Predict</button>
                            </form>
                            <script>
                                $(document).ready(function() {
                                    $("#myInput").on("keyup", function() {
                                        var value = $(this).val().toLowerCase();
                                        $("#myTable tr").filter(function() {
                                            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                                        });
                                    });
                                });

                            </script>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" {% if active_tab == 'smtable' %} class="tab-pane active" {% else %} class="tab-pane" {% endif %} id="smtable">
                    <form action="/plot" method="POST">
                        <label>Enter Company Sticker Symbol</label>
                        <select class="form-control" style="width: 30%;" class="searchbox" name="companyname" placeholder="Enter company sticker symbol" required>
                            <option>AAPL</option>
                            <option>ACN</option>
                            <option>ADBE</option>
                            <option>AMAT</option>
                            <option>AMD</option>
                            <option>AMZN</option>
                            <option>AVGO</option>
                            <option>BA</option>
                            <option>BABA</option>
                            <option>BBY</option>
                            <option>BMW</option>
                            <option>BRK.A</option>
                            <option>CRM</option>
                            <option>CSCO</option>
                            <option>CTSH</option>
                            <option>CTXS</option>
                            <option>DCM</option>
                            <option>DIS</option>
                            <option>EBAY</option>
                            <option>ERIC</option>
                            <option>FB</option>
                            <option>GOOGL</option>
                            <option>HPQ</option>
                            <option>IBM</option>
                            <option>INFY</option>
                            <option>INTC</option>
                            <option>INTL</option>
                            <option>JNPR</option>
                            <option>LMT</option>
                            <option>LNKD</option>
                            <option>MCAF</option>
                            <option>MSFT</option>
                            <option>MSI</option>
                            <option>MZLA</option>
                            <option>NFLX</option>
                            <option>NOK</option>
                            <option>NTAP</option>
                            <option>NVDA</option>
                            <option>ORCL</option>
                            <option>PARC</option>
                            <option>QCOM</option>
                            <option>SAP</option>
                            <option>SNAP</option>
                            <option>T</option>
                            <option>TCS</option>
                            <option>TGT</option>
                            <option>TIBX</option>
                            <option>TSLA</option>
                            <option>TWTR</option>
                            <option>TXN</option>
                            <option>VMW</option>
                            <option>VZ</option>
                            <option>WMT</option>
                            <option>YHOO</option>
                        </select>
                        <button type="submit" class="btn btn-primary" name="Search" class="ghost" id="signUp">Submit</button>
                    </form>
                    <marquee class="bottombar">Stock values are subjected to market risk. Prediction is based on machine learning models. Please invest at your own risk.</marquee>
                </div>
                <!---->
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });

    </script>
    {% endblock %}
